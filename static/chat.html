<!DOCTYPE html>

<head>
    <title>
        Playground
    </title>
    <style>
        body {
            font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
        }

        .container {
            margin-left: auto;
            margin-right: auto;
            margin-top: 3em;
            max-width: 800px;
        }

        input {
            width: 100%;
            height: 2em;
        }
    </style>
    <script>
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        const stream = new EventSource(`/api/join/${urlParams.get('id')}`);

        stream.onmessage = (event) => {
            const message = JSON.parse(event.data);
            const newChat = document.createElement("li");
            newChat.innerHTML = `<b>${message.role == 'user' ? 'You' : 'Suspect' }</b>: ${message.content}`; // I know :(
            document.getElementById("chat").appendChild(newChat);
        };

        async function send() {
            const content = document.getElementById("reply").value;
            if (!content) { return; }
            document.getElementById("reply").value = '';
            await fetch(`api/reply/${urlParams.get('id')}`, {
                method: 'POST', headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ content }),
            });
        }

        async function accusation(defective) {
            const response = await fetch(`api/submit/${urlParams.get('id')}`, {
                method: 'POST', headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ defective }),
            });
            const result = await response.json();
            alert(`You ${result.win ? 'win' : 'lose'}!\nDefect: ${result.defective ? result.defect : 'None'}`);
        }
    </script>
</head>

<body>
    <div class="container">
        <ul id="chat">
            <li><b>You</b>: Are you ready to begin the interview?</li>
        </ul>
        <input type="text" name="content" id="reply">
        <input type="submit" value="Reply" onclick="send();">
        <hr>
        Make your verdict: 
        <button onclick="accusation(false)">Human</button>
        <button onclick="accusation(true)">Android</button>
    </div>
</body>

</html>